(()=>{"use strict";var e,t={403:()=>{function e(){var e=document.querySelectorAll(".gallery-item");e.length>0&&e.forEach((function(e){!function(e){var t=e.querySelector('[data-action="removeGalleryItem"]');function n(){if(confirm("Удалить изображение?")){var e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),n=t.dataset.id;n&&fetch("/admin/ajax/removeGalleryItem",{method:"POST",headers:{"X-CSRF-TOKEN":e},body:n}).then((function(e){e.text().then((function(e){console.log("result:",e);var n=t.closest(".gallery-item");n&&n.remove()}))}))}}t.addEventListener("click",n)}(e)}))}function t(){var e=document.querySelector('[data-action="updateAvatar"]');if(e){var t=e.closest(".input-group").querySelector(".custom-file-input"),n=e.closest(".input-group").querySelector(".custom-file-label");t&&e.addEventListener("click",(function(){if(0==t.files.length&&alert("Выберите файл"),t.files.length>0){if(!confirm("Будет загружено новое изображение. Продолжить?"))return;var a=new FormData,o=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),r=e.dataset.id,i=e.dataset.type,l=t.files[0];r&&i&&l&&(a.append("page_id",r),a.append("page_type",i),a.append("avatar_file",l),fetch("/admin/ajax/updateAvatar",{method:"POST",headers:{"X-CSRF-TOKEN":o},body:a}).then((function(e){e.text().then((function(e){!function(e){var t=document.querySelector(".avatar");if(t){t.innerHTML="";var n=document.createElement("img");n.src=e,t.append(n),addDestroyImageButton(n)}}(e),t.value="",n&&(n.innerText="Файл не выбран")}))})))}}))}}function n(){var e=document.querySelectorAll('img[data-function="destroy"]');e&&e.forEach((function(e){!function(e){var t=e.src.split("/")[7],n=document.createElement("button");n.type="button",n.classList.add("destroy-image-btn"),n.dataset.id=t,n.innerHTML='<i class="fas fa-trash"></i>',e.nextElementSibling&&"BUTTON"==e.nextElementSibling.tagName&&e.nextElementSibling.classList.contains("destroy-image-btn")&&e.nextElementSibling.remove();function a(e,t){var n=document.querySelector('meta[name="csrf-token"]').getAttribute("content");confirm("Удалить изображение?")&&fetch("/admin/ajax/destroyImage",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8","X-CSRF-TOKEN":n},body:JSON.stringify({id:e})}).then((function(e){e.text().then((function(e){console.log("result:",e)})),t.parentElement.classList.contains("portfolio-gallery-image")?t.parentElement.remove():t.parentElement.querySelector("img").remove(),t.remove()}))}e.after(n),n.addEventListener("click",(function(e){e.preventDefault,a(t,n)}))}(e)}))}function a(){if(document.getElementById("portfolio-gallery")){var e=document.getElementById("portfolio-gallery"),t=e.cloneNode(!0),n=document.getElementById("portfolio-gallery-buttons"),a=n.querySelector('[data-action="sort"]'),o=n.querySelector('[data-action="save"]'),r=n.querySelector('[data-action="cancel"]');a.addEventListener("click",(function(){e.querySelectorAll(".portfolio-gallery-image").forEach((function(e){e.draggable=!0,e.querySelectorAll("img").forEach((function(e){e.style.pointerEvents="none"})),e.querySelectorAll("button").forEach((function(e){e.style.display="none"})),e.addEventListener("dragstart",c),e.addEventListener("dragover",s),e.addEventListener("dragend",d)})),a.setAttribute("disabled",""),o.removeAttribute("disabled"),r.removeAttribute("disabled")})),o.addEventListener("click",(function(){var t=[];e.querySelectorAll(".portfolio-gallery-image").forEach((function(e,n){var a=e.querySelector("img").src.split("/")[7];t.push({id:a,sort:n})}));var n=document.querySelector('meta[name="csrf-token"]').getAttribute("content");fetch("/admin/ajax/saveGallerySort",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8","X-CSRF-TOKEN":n},body:JSON.stringify(t)}).then((function(e){e.text().then((function(e){console.log("result:",e)}))})),l(),i()})),r.addEventListener("click",(function(){var n;n=t,e.replaceWith(n),l(),i(),e.querySelectorAll(".portfolio-gallery-image").forEach((function(e){e.querySelectorAll("img").forEach((function(e){addDestroyImageButton(e)}))}))}))}function i(){e=document.getElementById("portfolio-gallery"),t=e.cloneNode(!0)}function l(){e.querySelectorAll(".portfolio-gallery-image").forEach((function(e){e.removeAttribute("draggable"),e.querySelectorAll("img").forEach((function(e){e.removeAttribute("style")})),e.querySelectorAll("button").forEach((function(e){e.removeAttribute("style")})),e.removeEventListener("dragstart",c),e.removeEventListener("dragover",s),e.removeEventListener("dragend",d)})),a.removeAttribute("disabled"),o.setAttribute("disabled",""),r.setAttribute("disabled","")}function c(e){e.target.classList.add("selected")}function d(e){e.target.classList.remove("selected")}function s(t){t.preventDefault();var n=e.querySelector(".selected"),a=t.target;if(n!==a&&a.classList.contains("portfolio-gallery-image")){var o=a===n.nextElementSibling?a.nextElementSibling:a;e.insertBefore(n,o)}}}function o(){var e=document.querySelector('[data-action="addImagesToPortfolio"]');if(e){var t=e.closest(".input-group").querySelector(".custom-file-input"),n=e.closest(".input-group").querySelector(".custom-file-label");t&&e.addEventListener("click",(function(){if(0==t.files.length&&alert("Выберите файлы"),t.files.length>0){if(!confirm("Продолжить?"))return;var a=new FormData,o=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),r=e.dataset.id,i=e.dataset.type,l=t.files;if(r&&i&&l){a.append("page_id",r),a.append("page_type",i);for(var c=0;c<l.length;c++)a.append("images[".concat(c,"]"),l[c]);fetch("/admin/ajax/addImagesToPortfolio",{method:"POST",headers:{"X-CSRF-TOKEN":o},body:a}).then((function(e){e.text().then((function(e){var a,o;a=JSON.parse(e),(o=document.getElementById("portfolio-gallery"))&&a.forEach((function(e){var t=document.createElement("img");t.src=e,t.setAttribute("width","152px"),t.setAttribute("height","auto"),t.setAttribute("data-function","destroy");var n=document.createElement("div");n.classList.add("portfolio-gallery-image","mr-2","mt-1","mb-1","d-block","position-relative"),n.append(t),o.append(n),addDestroyImageButton(t)})),t.value="",n&&(n.innerText="Файлы не выбраны")}))}))}}}))}}function r(e){var t=e.querySelector('[data-action="saveQuestion"]');t.addEventListener("click",(function(){if(!confirm("Сохранить вопрос?"))return;var a=new FormData,o=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),r=t.dataset.id,i=e.querySelector('[data-name="name"]').value,l=e.querySelector('[data-name="answer"]').value,c=e.querySelector('[data-name="sort"]').value,d=t.dataset.faq;c||(c=1,e.querySelector('[data-name="sort"]').value=c);i&&l&&c&&(a.append("id",r),a.append("name",i),a.append("answer",l),a.append("sort",c),a.append("faq_id",d),fetch("/admin/ajax/saveQuestion",{method:"POST",headers:{"X-CSRF-TOKEN":o},body:a}).then((function(e){e.text().then((function(e){console.log("result:",JSON.parse(e)),n.dataset.id=JSON.parse(e).id}))})))}));var n=e.querySelector('[data-action="removeQuestion"]');n.addEventListener("click",(function(){if(!confirm("Удалить вопрос?"))return;var e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=n.dataset.id;t&&fetch("/admin/ajax/removeQuestion",{method:"POST",headers:{"X-CSRF-TOKEN":e},body:t}).then((function(e){e.text().then((function(e){console.log("result:",e);var t=n.closest(".question");t&&t.remove()}))}))}))}document.addEventListener("DOMContentLoaded",(function(){var i;tinymce.init({selector:".editor",plugins:"file-manager table link lists code fullscreen",Flmngr:{apiKey:"FLMNFLMN",urlFileManager:"/flmngr",urlFiles:"/storage/upload/files"},relative_urls:!1,extended_valid_elements:"*[*]",height:"500px",toolbar:["bold italic underline | alignleft aligncenter alignright alignjustify |  bullist numlist outdent indent | link blockquote table | code "],contextmenu:"undo redo | cut copy paste | inserttable",promotion:!1,language:"ru"}),e(),t(),n(),a(),o(),(i=document.querySelectorAll(".question")).length>0&&i.forEach((function(e){r(e)})),function(){var e=document.querySelector(".questions"),t=document.querySelector('button[data-action="addNewQuestion"]');if(e&&t){var n=t.dataset.faq;t.addEventListener("click",(function(){var t=Math.floor(9999*Math.random()),a=document.createElement("div");a.classList.add("question","col-md-6"),a.innerHTML='\n                <div class="card">\n                    <div class="card-body">\n                        <div class="form-group">\n                            <label for="question_name['.concat(t,']">Название</label>\n                            <input type="text" class="form-control" id="question_name[').concat(t,']"\n                                name="questions[').concat(t,'][name]" data-name="name">\n                        </div>\n                        <div class="form-group">\n                            <label for="question_answer[').concat(t,']">Ответ</label>\n                            <textarea id="question_answer[').concat(t,']" class="form-control" rows="3" name="questions[').concat(t,'][answer]" data-name="answer"></textarea>\n                        </div>\n                        <div class="row">\n                            <div class="col-md-5">\n                                <div class="form-group">\n                                    <label for="questions[').concat(t,'][sort]">Ключ сортировки</label>\n                                    <input type="text" class="form-control"\n                                        id="questions[').concat(t,'][sort]" name="questions[').concat(t,'][sort]" data-name="sort">\n                                </div>\n                            </div>\n                            <div class="col-md-5 d-flex align-items-end">\n                                <div class="form-group w-100">\n                                    <button type="button" class="btn btn-block btn-primary"\n                                        data-action="saveQuestion"\n                                        data-id="0"\n                                        data-faq="').concat(n,'">\n                                        Сохранить\n                                    </button>\n                                </div>\n                            </div>\n                            <div class="col-md-2 d-flex align-items-end">\n                                <div class="form-group w-100">\n                                    <button type="button" class="btn btn-block btn-danger"\n                                        data-action="removeQuestion"\n                                        data-id="{').concat(t,'}">\n                                        Удалить\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            '),e.append(a),r(a)}))}}(),bsCustomFileInput.init()}))},357:()=>{}},n={};function a(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,e=[],a.O=(t,n,o,r)=>{if(!n){var i=1/0;for(s=0;s<e.length;s++){for(var[n,o,r]=e[s],l=!0,c=0;c<n.length;c++)(!1&r||i>=r)&&Object.keys(a.O).every((e=>a.O[e](n[c])))?n.splice(c--,1):(l=!1,r<i&&(i=r));if(l){e.splice(s--,1);var d=o();void 0!==d&&(t=d)}}return t}r=r||0;for(var s=e.length;s>0&&e[s-1][2]>r;s--)e[s]=e[s-1];e[s]=[n,o,r]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={567:0,552:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var o,r,[i,l,c]=n,d=0;if(i.some((t=>0!==e[t]))){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(c)var s=c(a)}for(t&&t(n);d<i.length;d++)r=i[d],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(s)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),a.O(void 0,[552],(()=>a(403)));var o=a.O(void 0,[552],(()=>a(357)));o=a.O(o)})();
//# sourceMappingURL=admin.js.map